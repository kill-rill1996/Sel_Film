{% extends 'base.html' %}
{% load static %}

{% block title %}Подбор фильмов{% endblock title %}

{% block content %}

<!-- page title -->
<section class="section section--first section--bg" data-bg="{% static 'img/section/section.jpeg' %}">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="section__wrap">
          <!-- section title -->
          <h1 class="section__title">{% block left_section %}Подбор фильмов{% endblock left_section %}</h1>
          <!-- end section title -->

          <!-- breadcrumb -->
          <ul class="breadcrumb">
            <li class="breadcrumb__item"><a href="index.html">Главная</a></li>
            <li class="breadcrumb__item breadcrumb__item--active">{% block right_section %}Подбор фильмов{% endblock right_section %}</li>
          </ul>
          <!-- end breadcrumb -->
        </div>
      </div>
    </div>
  </div>
</section>
<!-- end page title -->

<div class="container mx-auto">
    <div class="grid grid-cols-1 sm:grid-cols-2 justify-items-center mt-10">

        <!--Левый фильм -->
        <div class="grid w-full justify-items-center">
            {% if film_1 %}
            <div class="mb-4 sm:mb-6">
                <h2 class="text-lg text-indigo-800"><a href="{{ film_1.get_absolute_url }}" target="_blank">{{ film_1.title_ru|capfirst }}
                {% block year_1 %}{% if film_1.year %} ({{ film_1.year }}){% endif %}{% endblock year_1 %}</a></h2>
            </div>
            <div class="grid w-2/5 sm:w-3/5 md:w-5/12 xl:w-3/5 justify-items-center">
                <a href="{{ film_1.get_absolute_url }}" target="_blank"><img class="rounded-lg shadow-lg" src="{{ film_1.image.url }}" alt=""></a>
            </div>
            {% else %}
            <div class="mb-4 sm:mb-6">
                <h2 class="text-lg text-indigo-800">{% block title_1 %}Фильм 1{% endblock title_1 %}</h2>
            </div>
            <div class="grid w-2/5 sm:w-3/5 md:w-5/12 xl:w-3/5 justify-items-center">
                <img class="rounded-lg shadow-lg" src="{% static 'images/poster.jpeg' %}" alt="">
            </div>
            {% endif %}
        </div>
 
        <!--Правый фильм-->
        <div class="grid w-full justify-items-center">
            {% if film_2 %}
                <div class="mt-8 sm:mt-0 mb-4 sm:mb-6">
                    <h2 class="text-lg text-indigo-800"><a href="{{ film_2.get_absolute_url }}" target="_blank">{{ film_2.title_ru|capfirst }} 
                    {% block year_2 %}{% if film_2.year %} ({{ film_2.year }}){% endif %}{% endblock year_2 %}</a></h2>
                </div>
                <div class="grid w-2/5 sm:w-3/5 md:w-5/12 xl:w-3/5 justify-items-center">
                    <a href="{{ film_2.get_absolute_url }}" target="_blank"><img class="rounded-lg shadow-lg" src="{{ film_2.image.url }}" alt=""></a>
                </div>
            {% else %}
                <div class="mt-8 sm:mt-0 mb-4 sm:mb-6">
                    <h2 class="text-lg text-indigo-800">{% block title_2 %}Фильм 2{% endblock title_2 %}</h2>
                </div>
                <div class="grid w-2/5 sm:w-3/5 md:w-5/12 xl:w-3/5 justify-items-center">
                    <img class="rounded-lg shadow-lg" src="{% static 'images/poster.jpeg' %}" alt="">
                </div>
            {% endif %}
        </div>
    </div>

    <!--    Поисковые вводы, кнопка поиска-->
    <div class="grid grid-cols-1">
        <div class="w-full justify-items-center">
               <div class="mt-6 w-full text-sm sm:text-base">
                   <form method="post"  action="{% block action_form %}{% url 'search-films' %}{% endblock action_form %}">
                        {% csrf_token %}
                        <div class="grid grid-cols-1 sm:grid-cols-2 justify-items-center">
                            <div class="w-44 mb-4 sm:mb-0 md:w-44 lg:w-56 xl:w-80 text-red-400">
                                {{ form_1 }}
                            </div>
                            <div class="w-44 mb-4 sm:mb-0 md:w-44 lg:w-56 xl:w-80 text-red-400">
                                {{ form_2 }}
                            </div>
                        </div>
                        <div class="grid grid-cols-1 justify-items-center">
                            <button type="submit" class="grid w-30 md:w-34 lg:w-40 bg-gray-100 text-gray-700 border-0 py-1 px-3 focus:outline-none hover:bg-gray-200 rounded-xl text-xs md:text-sm lg:text-base mt-4 md:mt-0"><span><i class="fas fa-search mr-2"></i>Подобрать</span></button>
                        </div>
                   </form>
               </div>
               {% if films_duplicate %}
                   <hr class="mt-8 mb-4">
                   <div class="flex flex-wrap -mx-4 -my-8 mb-4">
                      <div class="py-10 px-4 lg:w-1/3">
                        <div class="h-full flex items-start">
                          <div class="flex-grow pl-6">
                            <h2 class="tracking-widest text-xs title-font font-medium text-indigo-500 mb-1">РЕЗУЛЬТАТЫ ПОИСКА</h2>
                            <h1 class="title-font text-lg font-medium text-gray-900 mb-3">{% block pick_smth %}Выберите разные фильмы.{% endblock pick_smth %}</h1>
                          </div>
                        </div>
                      </div>
                    </div>
               {% else %}
                    {% if films_1_query or films_2_query %}
                        <hr class="mt-8 mb-4">
                        {% if films_1_query and not film_2 and not films_2_query %}
                            <div class="flex flex-wrap -mx-4 -my-8 mb-4">
                              <div class="py-10 px-4 lg:w-1/3">
                                <div class="h-full flex items-start">
                                  <div class="flex-grow pl-6">
                                    <h2 class="tracking-widest text-xs title-font font-medium text-indigo-500 mb-1">РЕЗУЛЬТАТЫ ПОИСКА</h2>
                                    <h1 class="title-font text-lg font-medium text-gray-900 mb-3">Возможно вы имели в виду (Фильм № 1):</h1>
                                    {% for film in films_1_query %}
                                    <div>
                                      <a target="_blank" href="{{ film.get_absolute_url }}" class="inline-flex items-center mb-4">
                                        <img alt="blog" src="{{ film.image.url }}" class="w-10 h-10 rounded-full flex-shrink-0 object-cover object-center">
                                        <span class="flex-grow flex flex-col pl-3">
                                          <span class="title-font font-base text-gray-900">{{ film.title_ru|capfirst }} {% block year_q1 %}({{ film.year }}){% endblock year_q1 %}</span>
                                        </span>
                                      </a>
                                    </div>
                                    {% endfor %}
                                    <h1 class="title-font text-lg font-medium text-gray-900 mb-3">Фильм № 2 не найден.</h1>
                                  </div>
                                </div>
                              </div>
                            </div>
                        {% endif %}

                        {% if films_1_query and film_2 %}
                        <div class="flex flex-wrap -mx-4 -my-8 mb-4">
                          <div class="py-10 px-4 lg:w-1/3">
                            <div class="h-full flex items-start">
                              <div class="flex-grow pl-6">
                                <h2 class="tracking-widest text-xs title-font font-medium text-indigo-500 mb-1">РЕЗУЛЬТАТЫ ПОИСКА</h2>
                                <h1 class="title-font text-lg font-medium text-gray-900 mb-3">Возможно вы имели в виду (Фильм № 1):</h1>
                                {% for film in films_1_query %}
                                <div>
                                  <a target="_blank" href="{{ film.get_absolute_url }}" class="inline-flex items-center">
                                    <img alt="blog" src="{{ film.image.url }}" class="w-10 h-10 rounded-full flex-shrink-0 object-cover object-center">
                                    <span class="flex-grow flex flex-col pl-3">
                                      <span class="title-font font-base text-gray-900">{{ film.title_ru|capfirst }} {% block year_q1f2 %}({{ film.year }}){% endblock year_q1f2 %}</span>
                                    </span>
                                  </a>
                                </div>
                                {% endfor %}
                              </div>
                            </div>
                          </div>
                        </div>
                        {% endif %}

                        {% if films_2_query and not film_1 and not films_1_query %}
                            <div class="flex flex-wrap -mx-4 -my-8 mb-4">
                              <div class="py-10 px-4 lg:w-1/3">
                                <div class="h-full flex items-start">
                                  <div class="flex-grow pl-6">
                                    <h2 class="tracking-widest text-xs title-font font-medium text-indigo-500 mb-1">РЕЗУЛЬТАТЫ ПОИСКА</h2>
                                    <h1 class="title-font text-lg font-medium text-gray-900 mb-4">Фильм № 1 не найден.</h1>
                                    <h1 class="title-font text-lg font-medium text-gray-900 mb-3">Возможно вы имели в виду (Фильм № 2):</h1>
                                    {% for film in films_2_query %}
                                    <div>
                                      <a target="_blank" href="{{ film.get_absolute_url }}" class="inline-flex items-center">
                                        <img alt="blog" src="{{ film.image.url }}" class="w-10 h-10 rounded-full flex-shrink-0 object-cover object-center">
                                        <span class="flex-grow flex flex-col pl-3">
                                          <span class="title-font font-base text-gray-900">{{ film.title_ru|capfirst }} {% block year_q2 %}({{ film.year }}){% endblock year_q2 %}</span>
                                        </span>
                                      </a>
                                    </div>
                                    {% endfor %}
                                  </div>
                                </div>
                              </div>
                            </div>
                        {% endif %}

                        {% if films_2_query and film_1 %}
                            <div class="flex flex-wrap -mx-4 -my-8 mb-4">
                              <div class="py-10 px-4 lg:w-1/3">
                                <div class="h-full flex items-start">
                                  <div class="flex-grow pl-6">
                                    <h2 class="tracking-widest text-xs title-font font-medium text-indigo-500 mb-1">РЕЗУЛЬТАТЫ ПОИСКА</h2>
                                    <h1 class="title-font text-lg font-medium text-gray-900 mb-3">Возможно вы имели в виду (Фильм № 2):</h1>
                                    {% for film in films_2_query %}
                                    <div>
                                      <a target="_blank" href="{{ film.get_absolute_url }}" class="inline-flex items-center">
                                        <img alt="blog" src="{{ film.image.url }}" class="w-10 h-10 rounded-full flex-shrink-0 object-cover object-center">
                                        <span class="flex-grow flex flex-col pl-3">
                                          <span class="title-font font-base text-gray-900">{{ film.title_ru|capfirst }} {% block year_q2f1 %}({{ film.year }}){% endblock year_q2f1 %}</span>
                                        </span>
                                      </a>
                                    </div>
                                    {% endfor %}
                                  </div>
                                </div>
                              </div>
                            </div>
                        {% endif %}

                        {% if films_1_query and films_2_query %}
                            <div class="flex flex-wrap -mx-4 -my-8 mb-4">
                              <div class="py-10 px-4 lg:w-1/3">
                                <div class="h-full flex items-start">
                                  <div class="flex-grow pl-6">
                                    <h2 class="tracking-widest text-xs title-font font-medium text-indigo-500 mb-1">РЕЗУЛЬТАТЫ ПОИСКА</h2>
                                    <h1 class="title-font text-lg font-medium text-gray-900 mb-3">Возможно вы имели в виду (Фильм № 1):</h1>
                                    {% for film in films_1_query %}
                                    <div>
                                      <a target="_blank" href="{{ film.get_absolute_url }}" class="inline-flex items-center">
                                        <img alt="blog" src="{{ film.image.url }}" class="w-10 h-10 rounded-full flex-shrink-0 object-cover object-center">
                                        <span class="flex-grow flex flex-col pl-3">
                                          <span class="title-font font-base text-gray-900">{{ film.title_ru|capfirst }} {% block year_q2q1 %}({{ film.year }}){% endblock year_q2q1 %}</span>
                                        </span>
                                      </a>
                                    </div>
                                    {% endfor %}
                                    <h1 class="title-font text-lg font-medium text-gray-900 mb-3">Возможно вы имели в виду (Фильм № 2):</h1>
                                    {% for film in films_2_query %}
                                    <div>
                                      <a target="_blank" href="{{ film.get_absolute_url }}" class="inline-flex items-center">
                                        <img alt="blog" src="{{ film.image.url }}" class="w-10 h-10 rounded-full flex-shrink-0 object-cover object-center">
                                        <span class="flex-grow flex flex-col pl-3">
                                          <span class="title-font font-base text-gray-900">{{ film.title_ru|capfirst }} {% block year_q1q2 %}({{ film.year }}){% endblock year_q1q2 %}</span>
                                        </span>
                                      </a>
                                    </div>
                                    {% endfor %}
                                  </div>
                                </div>
                              </div>
                            </div>
                        {% endif %}

                    {% elif film_1 and not film_2 %}
                        <hr class="mt-8 mb-4">
                        <div class="flex flex-wrap -mx-4 -my-8 mb-4">
                          <div class="py-10 px-4 lg:w-1/3">
                            <div class="h-full flex items-start">
                              <div class="flex-grow pl-6">
                                <h2 class="tracking-widest text-xs title-font font-medium text-indigo-500 mb-1">РЕЗУЛЬТАТЫ ПОИСКА</h2>
                                <h1 class="title-font text-lg font-medium text-gray-900 mb-3">Фильм № 2 не найден.</h1>
                              </div>
                            </div>
                          </div>
                        </div>

                    {% elif film_2 and not film_1 %}
                        <hr class="mt-8 mb-4">
                        <div class="flex flex-wrap -mx-4 -my-8 mb-4">
                          <div class="py-10 px-4 lg:w-1/3">
                            <div class="h-full flex items-start">
                              <div class="flex-grow pl-6">
                                <h2 class="tracking-widest text-xs title-font font-medium text-indigo-500 mb-1">РЕЗУЛЬТАТЫ ПОИСКА</h2>
                                <h1 class="title-font text-lg font-medium text-gray-900 mb-3">Фильм № 1 не найден.</h1>
                              </div>
                            </div>
                          </div>
                        </div>
                    {% elif request.method == 'POST' and not film_1 and not film_2 %}
                        <hr class="mt-8 mb-4">
                        <div class="flex flex-wrap -mx-4 -my-8 mb-4">
                          <div class="py-10 px-4 lg:w-2/3">
                            <div class="h-full flex items-start">
                              <div class="flex-grow pl-6">
                                <h2 class="tracking-widest text-xs title-font font-medium text-indigo-500 mb-1">РЕЗУЛЬТАТЫ ПОИСКА</h2>
                                <p>По вашему запросу фильмы не найдены. Попробуйте найти названия фильмов через <a class="text-indigo-500" href="#search">поиск</a></p>
                              </div>
                            </div>
                          </div>
                        </div>
                    {% endif %}
                {% endif %}
        </div>
    </div>


<!--Результаты поиска-->
    {% if top_ten %}
    <hr class="mt-8 mb-6">
    <h2 class="tracking-widest text-xs title-font font-medium text-indigo-500 text-center sm:text-left md:ml-3 xl:ml-0">РЕЗУЛЬТАТЫ ПОИСКА</h2>
        <div class="grid grid-cols-2 sm:grid-cols-5 xl:grid-cols-10 gap-x-4 gap-y-4 sm:gap-x-10 sm:gap-y-10 mt-10 text-sm sm:text-xs md:text-sm mb-8">
                {% for film in top_ten %}
                    {% include 'includes/card_for_top_ten.html' %}
                {% endfor %}
        </div>
    {% endif %}
</div>

{% endblock content %}

























